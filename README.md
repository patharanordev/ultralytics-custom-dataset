# Object Detection

Based on Ultralytics's Yolo, latest is v11.

## Prerequisites

For container image, please refer to [Docker hub "nvidia-cuda-win64"](https://hub.docker.com/r/patharanor/nvidia-cuda-win64).

## Usage

### Train

```sh
cd scripts/{PROJECT_NAME}
start.train.ps1
```

Example `start.train.ps1`:

```sh
docker compose -f .\{PROJECT_NAME}.train.yml down -v --remove-orphans; `
docker rmi -f $(docker images -f 'dangling=true' -q); `
docker compose -f .\{PROJECT_NAME}.train.yml up --build;
```

Example `{PROJECT_NAME}.train.yml`:

```yml
services:
  train:
    container_name: train-{PROJECT_NAME}-model
    build: 
      context: ../..
      dockerfile: Dockerfile
    volumes:
      - ../../projects/{PROJECT_NAME}/dataset:/workspace/dataset:rw
      - ../../projects/{PROJECT_NAME}/output:/workspace/output:rw
      - ../../models/{PROJECT_NAME}:/workspace/runs/detect:rw
      - ../../src:/workspace/src:rw
    command: src/train.py
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [ gpu ]
    restart: no
```

Example `{PROJECT_NAME}.predict.yml`:

```yml
services:
  train:
    container_name: train-{PROJECT_NAME}-model
    build: 
      context: ../..
      dockerfile: Dockerfile
    volumes:
      - ../../projects/{PROJECT_NAME}/dataset:/workspace/dataset:rw
      - ../../projects/{PROJECT_NAME}/output:/workspace/output:rw
      - ../../models/{PROJECT_NAME}:/workspace/runs/detect:rw
      - ../../src:/workspace/src:rw
    command: src/predict.py
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [ gpu ]
    restart: no
```

Auto-stop.

### Predict

```sh
cd scripts/{PROJECT_NAME}
start.predict.ps1
```

## Contributing

### Directory Structure

```txt
repo
|- models
|  |- {PROJECT_NAME1}
|  |  `- # generated by Ultralytics
|  |- {PROJECT_NAME2}
|  |  `- # generated by Ultralytics
|  |- # any project
|  `- yolov11.yaml # or other version (NN layer config)
|- projects
|  `- {PROJECT_NAME1}
|     |- dataset
|     |  |- train
|     |  |  |- images
|     |  |  |  `- *.jpg
|     |  |  `- labels
|     |  |     `- *.txt
|     |  |- valid
|     |  |  |- images
|     |  |  |  `- *.jpg
|     |  |  `- labels
|     |  |     `- *.txt
|     |  |- test
|     |  |  `- images
|     |  |     `- *.jpg
|     |  `- dataset.yaml
|     `- output # contains predicted result
|        `- *.jpg
|- scripts
|  `- {PROJECT_NAME1}
|     |- train.yml # docker compose for train
|     `- predict.yml # docker compose for predict
|- src
|  |- train.py
|  `- predict.py
|- Dockerfile
`- requirements.txt
```

### Custom Datasets

Label based on Yolo structure:

```txt
<class> <x> <y> <width> <height>
```

Dataset config, example:

```yml
path: ../dataset # dataset root dir
train: train/images # train images (relative to 'path') 143 images
val: valid/images # val images (relative to 'path') 35 images

# Classes
names:
  0: signature
```
